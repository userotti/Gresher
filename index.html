<!DOCTYPE HTML>
<html>
<head>
	<title>pixi.js example 13 - Graphics</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #000000;
		}
	</style>
	
	<script src="bower_components/pixi/bin/pixi.dev.js"></script>
	
</head>
<body>
	<script>
	
	
	var stage = new PIXI.Stage(0x192c50, true);
	
	stage.setInteractive(true);
	var renderer = PIXI.autoDetectRenderer(1000, 300);
	
	renderer.view.style.display = "block";
	 
	// add render view to DOM
	document.body.appendChild(renderer.view);
	
	makeAndReturn = function() {


			var tower = new PIXI.DisplayObjectContainer();

			tower.health = (Math.floor(Math.random() * 5) + 1) * 10;
			console.log("tower.health: " + tower.health);

			tower.speed = Math.floor(Math.random() * 5) + 1;
			console.log("tower.speed: " + tower.speed);

			tower.shield = Math.floor(Math.random() * 5) + 1;
			console.log("tower.shield: " + tower.shield);

			tower.shielrecharge = Math.floor(Math.random() * 5) + 1;
			console.log("tower.shielrecharge: " + tower.shielrecharge);

			tower.range = ((Math.floor(Math.random() * 5) + 1) * 10) + 40;
			console.log("tower.range: " + tower.range);

			tower.reload = (Math.floor(Math.random() * 5) + 1) / 3;
			console.log("tower.reload: " + tower.reload);

			tower.damage = Math.floor(Math.random() * 5) + 1;
			console.log("tower.damage: " + tower.damage);

		/*	tower.turning = (Math.floor(Math.random() * 5) + 1) / 3;
			console.log("tower.reload: " + tower.turning);

			tower.energy = Math.floor(Math.random() * 5) + 1;
			console.log("tower.damage: " + tower.turning); */



			//body ----------

			var body = new PIXI.Graphics();
			var color;
			var x,y


				for (var i = 0; i <  10; i++) {

					color = '0x' + (function co(lor){   return (lor +=
					  ['a',5,5,'a',5,5,6,7,8,9,'a','b','c','a','a','a'][Math.floor(Math.random()*16)])
					  && (lor.length == 2) ?  lor : co(lor); })('') + '3333';

					x = Math.floor(Math.random() * tower.health)-tower.health/2;
					y = Math.floor(Math.random() * tower.health)-tower.health/2;
					radius = tower.health/(2.5+i);

					
					body.lineStyle(radius/2, color, 1);
					body.moveTo(x,y);
					body.lineTo(0,0);

					body.lineStyle(0, 0x000000, 0.0);


					body.beginFill(color, 1);

					body.drawCircle(x, y, radius);
					body.endFill();		

					
					
				}

			body.beginFill(0xFFFFFF, 0.03);
			body.drawCircle(0, 0, (1 + (tower.health/2)*2)) ;
			body.endFill();		
			
			

			// weapon ----------

			var weapon = new PIXI.Graphics();
			var color;
			var x,y;
			var angle_step;
			var radius = (tower.range);


			color = '0xFFFFFF'

			angle_step = (Math.PI * 2) / tower.damage;
			console.log((angle_step/Math.PI)*180);

			for (var i = 0; i < tower.damage; i++) {
							
					weapon.beginFill(color, 1);
					weapon.drawCircle(Math.cos(angle_step*i)*radius, Math.sin(angle_step*i)*radius, (tower.damage/2)+1);
					weapon.endFill();		


			};

			weapon.beginFill(0xFFcccc, 0.03);
			weapon.drawCircle(0, 0,  (radius)) ;
			weapon.endFill();		
			

			// main build
			tower.addChild(body);
			tower.addChild(weapon);

			tower.position.x = Math.random()*1000;
			tower.position.y = Math.random()*300;
			
			return tower;

	};



	var towers = [];
	
	for (var i = 0; i < 6; i++) {
	
		towers.push(makeAndReturn());
	}	


	for (var i = 0; i < towers.length; i++) {
	

		stage.addChild(towers[i]);

	}	
	//stage adding	

	
	

	
	var count = 0;


	// run the render loop
	requestAnimFrame(loop);



	function loop() {
		
		count += 0.03;
		
	for (var i = 0; i < towers.length; i++) {
			
		towers[i].getChildAt(1).rotation = count * towers[i].reload;
		towers[i].getChildAt(0).rotation = -(count * towers[i].reload/4) 


	}	

	    	renderer.render(stage);
	    	requestAnimFrame( loop );
	}


	</script>

	</body>
</html>
